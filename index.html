<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Crypto Signals Pro</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/luxon@3"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-luxon@1"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-zoom@2"></script>
    <style>
        :root {
            --bg: #0f172a;
            --card-bg: #1e293b;
            --text: #e2e8f0;
            --text-muted: #94a3b8;
            --accent: #3b82f6;
            --green: #10b981;
            --red: #ef4444;
        }
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            margin: 0; 
            padding: 10px; 
            background: var(--bg); 
            color: var(--text);
            min-height: 100vh;
        }
        h1 { text-align: center; font-size: 1.8em; margin: 10px 0; color: var(--text); }
        p { text-align: center; margin: 8px 0; font-size: 0.95em; color: var(--text-muted); }
        #search-container { text-align: center; margin: 15px 0; }
        #search-input { padding: 10px; width: 70%; max-width: 300px; border: 1px solid #334155; background: var(--card-bg); color: var(--text); border-radius: 5px; }
        #add-favorite { padding: 10px 15px; background: var(--accent); color: white; border: none; border-radius: 5px; cursor: pointer; }
        #top-table { width: 100%; border-collapse: collapse; margin: 20px 0; background: var(--card-bg); border-radius: 8px; overflow: hidden; box-shadow: 0 4px 20px rgba(0,0,0,0.3); }
        #top-table th, #top-table td { padding: 12px; text-align: center; border-bottom: 1px solid #334155; }
        #top-table th { background: #1e293b; color: var(--text-muted); font-size: 0.9em; }
        #top-table td { vertical-align: middle; }
        .token-info { display: flex; align-items: center; justify-content: center; gap: 10px; }
        .token-icon { width: 32px; height: 32px; border-radius: 50%; }
        .token-name { font-weight: bold; }
        .mini-chart-container { position: relative; height: 50px; width: 120px; margin: 0 auto; }
        .price-cell { font-size: 1.1em; font-weight: bold; }
        .arrow { font-size: 1.2em; margin-left: 8px; }
        .green { color: var(--green); }
        .red { color: var(--red); }
        #token-list { display: flex; flex-wrap: wrap; justify-content: center; gap: 10px; margin: 20px 0; }
        .token-btn { padding: 10px 20px; background: var(--card-bg); border: 1px solid #334155; border-radius: 5px; cursor: pointer; color: var(--text); transition: background 0.3s; }
        .token-btn:hover { background: #334155; }
        .token-btn.selected { background: var(--accent); }
        #content { background: var(--card-bg); padding: 15px; border-radius: 8px; box-shadow: 0 4px 20px rgba(0,0,0,0.3); margin-top: 20px; }
        #tabs { display: flex; justify-content: space-around; margin-bottom: 15px; border-bottom: 1px solid #334155; }
        .tab-btn { padding: 12px; background: transparent; border: none; cursor: pointer; flex: 1; text-align: center; color: var(--text-muted); transition: color 0.3s; }
        .tab-btn.active { color: var(--text); border-bottom: 3px solid var(--accent); }
        table { width: 100%; border-collapse: collapse; font-size: 0.9em; }
        th, td { border: 1px solid #334155; padding: 8px; text-align: center; }
        th { background: #1e293b; }
        .buy { background: rgba(16,185,129,0.2); color: var(--green); }
        .sell { background: rgba(239,68,68,0.2); color: var(--red); }
        .neutral { background: rgba(148,163,184,0.2); }
        .action-btn { padding: 12px; font-size: 1em; border-radius: 5px; cursor: pointer; display: block; width: 90%; margin: 10px auto; text-decoration: none; color: white; text-align: center; font-weight: bold; }
        .buy-btn { background: var(--green); }
        .sell-btn { background: var(--red); }
        .chart-container { position: relative; height: 300px; margin: 20px 0; }
        .news-item { margin-bottom: 15px; border-bottom: 1px solid #334155; padding-bottom: 10px; }
        .news-item a { color: var(--accent); text-decoration: none; }
        .news-item a:hover { text-decoration: underline; }
        @media (min-width: 600px) {
            #content { max-width: 800px; margin: 20px auto; }
        }
    </style>
</head>
<body>
    <h1>Crypto Signals Pro</h1>
    <p>Top 10 by Market Cap + Favorites | Updated: <span id="last-update"></span></p>
    
    <div id="search-container">
        <input id="search-input" type="text" placeholder="Search any token (e.g., solana)">
        <button id="add-favorite">Add Favorite</button>
    </div>
    
    <table id="top-table">
        <thead>
            <tr>
                <th>Icon</th>
                <th>Symbol - Name</th>
                <th>Mini Graph (30 days)</th>
                <th>Latest Price</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>
    
    <div id="token-list"></div>
    
    <div id="content" style="display: none;">
        <div id="tabs">
            <button class="tab-btn active" data-tab="overview">Overview</button>
            <button class="tab-btn" data-tab="community">Community</button>
            <button class="tab-btn" data-tab="about">About</button>
        </div>
        <div id="overview" class="tab-content"></div>
        <div id="community" class="tab-content" style="display: none;"></div>
        <div id="about" class="tab-content" style="display: none;"></div>
    </div>

    <script>
        const CRYPTOPANIC_TOKEN = '1c5d36d83941f66b7c828ee52b1017ea4e019f9f';

        let selectedToken = null;
        let favorites = JSON.parse(localStorage.getItem('cryptoFavorites') || '[]');
        let topTokens = [];
        let chartInstances = {};

        async function fetchTopTokens() {
            const res = await fetch('https://api.coingecko.com/api/v3/coins/markets?vs_currency=usd&order=market_cap_desc&per_page=10&page=1&sparkline=true&price_change_percentage=24h');
            const data = await res.json();
            topTokens = data.map(coin => ({
                id: coin.id,
                name: coin.name,
                symbol: coin.symbol.toUpperCase(),
                image: coin.image,
                price: coin.current_price,
                signal: coin.price_change_percentage_24h > 0 ? 'buy' : 'sell', // Simple 24h momentum for arrow
                sparkline: coin.sparkline_in_7d.price // Use 7d sparkline, but we'll fetch 30d for detailed
            }));
            renderTopTable();
            renderTokenList();
        }

        function renderTopTable() {
            const tbody = document.querySelector('#top-table tbody');
            tbody.innerHTML = '';
            topTokens.forEach(async (token) => {
                // Fetch 30 days mini data
                const histRes = await fetch(`https://api.coingecko.com/api/v3/coins/${token.id}/market_chart?vs_currency=usd&days=30`);
                const histData = await histRes.json();
                const prices = histData.prices.map(p => p[1]);

                const row = document.createElement('tr');
                row.innerHTML = `
                    <td><img class="token-icon" src="${token.image}" alt="${token.symbol}"></td>
                    <td class="token-info">
                        <div>
                            <div class="token-name">${token.symbol} - ${token.name}</div>
                        </div>
                    </td>
                    <td><div class="mini-chart-container"><canvas id="mini-${token.id}"></canvas></div></td>
                    <td class="price-cell">
                        $${token.price.toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2})}
                        <span class="arrow ${token.signal === 'buy' ? 'green' : 'red'}">
                            ${token.signal === 'buy' ? '↑' : '↓'}
                        </span>
                    </td>
                `;
                tbody.appendChild(row);

                const ctx = document.getElementById(`mini-${token.id}`).getContext('2d');
                const isUp = prices[prices.length-1] > prices[0];
                new Chart(ctx, {
                    type: 'line',
                    data: { datasets: [{ data: prices, borderColor: isUp ? 'rgb(16,185,129)' : 'rgb(239,68,68)', fill: false, tension: 0.4, pointRadius: 0 }] },
                    options: { responsive: true, maintainAspectRatio: false, scales: { x: { display: false }, y: { display: false } }, plugins: { legend: { display: false }, tooltip: { enabled: false } } }
                });
            });
        }

        // Rest of the code (renderTokenList, selectToken, loadOverview, etc.) remains similar but with dark theme classes

        // ... (include the previous functions: renderTokenList, createTokenButton, selectToken, showTab, loadOverview (with chart destroy), loadCommunity, loadAbout, searchToken, openOKXSpotTrading, calculateSMA/RSI)

        // For brevity, the detailed tab functions are the same as before, just colors adjusted via CSS variables

        document.getElementById('last-update').textContent = new Date().toLocaleString();

        fetchTopTokens();
        setInterval(() => {
            document.getElementById('last-update').textContent = new Date().toLocaleString();
            fetchTopTokens(); // Faster refresh for top table
            if (selectedToken) loadOverview(selectedToken);
        }, 300000);
    </script>
</body>
</html>
